# ä»»åŠ¡ç®¡ç†æŒ‡å—

æœ¬æ–‡æ¡£ä»‹ç»AFçˆ¬è™«ç³»ç»Ÿçš„ä»»åŠ¡ç®¡ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä»»åŠ¡åˆå§‹åŒ–ã€ç»´æŠ¤ã€ç›‘æ§ç­‰æ“ä½œã€‚

## ğŸ“‹ ç›®å½•

- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [ä»»åŠ¡ç®¡ç†å·¥å…·](#ä»»åŠ¡ç®¡ç†å·¥å…·)
- [ä»»åŠ¡åˆå§‹åŒ–è„šæœ¬](#ä»»åŠ¡åˆå§‹åŒ–è„šæœ¬)
- [å¸¸ç”¨æ“ä½œ](#å¸¸ç”¨æ“ä½œ)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šä½¿ç”¨å›¾å½¢åŒ–ç®¡ç†å·¥å…·ï¼ˆæ¨èï¼‰

```bash
# Windowsç”¨æˆ·
task_manager.bat

# æˆ–è€…ç›´æ¥è¿è¡Œ
python scripts/task_manager.py
```

### æ–¹å¼äºŒï¼šä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·

```bash
# æŸ¥çœ‹å¸®åŠ©
python scripts/init_tasks.py --help

# åˆå§‹åŒ–ç”¨æˆ·åº”ç”¨ä»»åŠ¡
python scripts/init_tasks.py --init-user-apps

# åˆå§‹åŒ–åº”ç”¨æ•°æ®ä»»åŠ¡
python scripts/init_tasks.py --init-app-data --days 7
```

## ğŸ› ï¸ ä»»åŠ¡ç®¡ç†å·¥å…·

### å›¾å½¢åŒ–ç®¡ç†ç•Œé¢

ä»»åŠ¡ç®¡ç†å·¥å…·æä¾›äº†å‹å¥½çš„äº¤äº’ç•Œé¢ï¼ŒåŒ…å«ä»¥ä¸‹åŠŸèƒ½æ¨¡å—ï¼š

#### 1. ä»»åŠ¡ä»ªè¡¨æ¿
- ğŸ“Š å®æ—¶ä»»åŠ¡ç»Ÿè®¡
- ğŸ“ˆ æœ€è¿‘24å°æ—¶ä»»åŠ¡è¶‹åŠ¿
- ğŸ“‹ æŒ‰ä»»åŠ¡ç±»å‹åˆ†ç±»ç»Ÿè®¡
- ğŸ¯ æˆåŠŸç‡åˆ†æ

#### 2. ä»»åŠ¡åˆå§‹åŒ–
- ğŸš€ åˆå§‹åŒ–ç”¨æˆ·åº”ç”¨åŒæ­¥ä»»åŠ¡
- ğŸ“± åˆå§‹åŒ–åº”ç”¨æ•°æ®åŒæ­¥ä»»åŠ¡
- ğŸ”„ æ‰¹é‡åˆå§‹åŒ–æ‰€æœ‰ä»»åŠ¡

#### 3. ä»»åŠ¡ç»´æŠ¤
- ğŸ”§ é‡ç½®å¤±è´¥ä»»åŠ¡
- â° æ¢å¤è¶…æ—¶ä»»åŠ¡
- ğŸ—‘ï¸ æ¸…ç†è¿‡æœŸä»»åŠ¡
- ğŸ”„ é‡ç½®æ‰€æœ‰ä»»åŠ¡

#### 4. ä»»åŠ¡ç›‘æ§
- ğŸ“¡ å®æ—¶ç›‘æ§
- ğŸ”„ æŸ¥çœ‹è¿è¡Œä¸­ä»»åŠ¡
- âŒ æŸ¥çœ‹å¤±è´¥ä»»åŠ¡
- â° æŸ¥çœ‹è¶…æ—¶ä»»åŠ¡

#### 5. æ‰¹é‡æ“ä½œ
- ğŸ“¦ æ‰¹é‡åˆ›å»ºç”¨æˆ·åº”ç”¨ä»»åŠ¡
- ğŸ“Š æ‰¹é‡åˆ›å»ºåº”ç”¨æ•°æ®ä»»åŠ¡
- ğŸ”„ æ‰¹é‡é‡ç½®æŒ‡å®šç”¨æˆ·ä»»åŠ¡
- ğŸ—‘ï¸ æ‰¹é‡åˆ é™¤æŒ‡å®šç±»å‹ä»»åŠ¡

#### 6. è‡ªå®šä¹‰ä»»åŠ¡
- ğŸ¯ åˆ›å»ºå•ä¸ªä»»åŠ¡
- ğŸ“‹ æŸ¥çœ‹ä»»åŠ¡è¯¦æƒ…
- âš¡ ä¿®æ”¹ä»»åŠ¡ä¼˜å…ˆçº§

## ğŸ“œ ä»»åŠ¡åˆå§‹åŒ–è„šæœ¬

### åŸºæœ¬ç”¨æ³•

```bash
# æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
python scripts/init_tasks.py --help

# åˆå§‹åŒ–ç”¨æˆ·åº”ç”¨ä»»åŠ¡
python scripts/init_tasks.py --init-user-apps

# åˆå§‹åŒ–åº”ç”¨æ•°æ®ä»»åŠ¡ï¼ˆé»˜è®¤1å¤©ï¼‰
python scripts/init_tasks.py --init-app-data

# åˆå§‹åŒ–åº”ç”¨æ•°æ®ä»»åŠ¡ï¼ˆæŒ‡å®šå¤©æ•°ï¼‰
python scripts/init_tasks.py --init-app-data --days 7

# å¼ºåˆ¶é‡æ–°åˆ›å»ºä»»åŠ¡
python scripts/init_tasks.py --init-user-apps --force
```

### ä»»åŠ¡ç»´æŠ¤

```bash
# é‡ç½®å¤±è´¥ä»»åŠ¡
python scripts/init_tasks.py --reset-failed

# é‡ç½®æŒ‡å®šç±»å‹çš„å¤±è´¥ä»»åŠ¡
python scripts/init_tasks.py --reset-failed --task-type user_apps

# æ¢å¤è¶…æ—¶ä»»åŠ¡ï¼ˆé»˜è®¤2å°æ—¶ï¼‰
python scripts/init_tasks.py --recover-timeout

# æ¢å¤è¶…æ—¶ä»»åŠ¡ï¼ˆæŒ‡å®šå°æ—¶æ•°ï¼‰
python scripts/init_tasks.py --recover-timeout --timeout-hours 4

# æ¸…ç†è¿‡æœŸä»»åŠ¡ï¼ˆé»˜è®¤30å¤©ï¼‰
python scripts/init_tasks.py --clean-old

# æ¸…ç†è¿‡æœŸä»»åŠ¡ï¼ˆæŒ‡å®šå¤©æ•°ï¼‰
python scripts/init_tasks.py --clean-old --days 7
```

### ä»»åŠ¡æŸ¥è¯¢

```bash
# æŸ¥çœ‹ä»»åŠ¡ç»Ÿè®¡
python scripts/init_tasks.py --stats

# åˆ›å»ºè‡ªå®šä¹‰ä»»åŠ¡
python scripts/init_tasks.py --create-task \
  --task-type app_data \
  --username test@example.com \
  --app-id com.example.app \
  --start-date 2024-01-01 \
  --end-date 2024-01-01 \
  --priority 1
```

## ğŸ”§ å¸¸ç”¨æ“ä½œ

### 1. æ—¥å¸¸ä»»åŠ¡åˆå§‹åŒ–

```bash
# æ¯æ—¥åˆå§‹åŒ–æµç¨‹
python scripts/init_tasks.py --init-user-apps
python scripts/init_tasks.py --init-app-data --days 1
```

### 2. æ‰¹é‡æ•°æ®è¡¥å½•

```bash
# è¡¥å½•è¿‡å»7å¤©çš„æ•°æ®
python scripts/init_tasks.py --init-app-data --days 7 --force
```

### 3. ç³»ç»Ÿç»´æŠ¤

```bash
# é‡ç½®å¤±è´¥ä»»åŠ¡
python scripts/init_tasks.py --reset-failed

# æ¢å¤è¶…æ—¶ä»»åŠ¡
python scripts/init_tasks.py --recover-timeout

# æ¸…ç†30å¤©å‰çš„ä»»åŠ¡
python scripts/init_tasks.py --clean-old --days 30
```

### 4. ç›‘æ§å’Œç»Ÿè®¡

```bash
# æŸ¥çœ‹ä»»åŠ¡ç»Ÿè®¡
python scripts/init_tasks.py --stats

# ä½¿ç”¨å›¾å½¢åŒ–ç•Œé¢ç›‘æ§
python scripts/task_manager.py
```

## ğŸ“Š ä»»åŠ¡ç±»å‹è¯´æ˜

### user_apps ä»»åŠ¡
- **ç”¨é€”**: åŒæ­¥ç”¨æˆ·çš„åº”ç”¨åˆ—è¡¨
- **é¢‘ç‡**: é€šå¸¸æ¯æ—¥æ‰§è¡Œä¸€æ¬¡
- **æ•°æ®**: è·å–ç”¨æˆ·å®‰è£…çš„åº”ç”¨ä¿¡æ¯

### app_data ä»»åŠ¡
- **ç”¨é€”**: åŒæ­¥åº”ç”¨çš„ä½¿ç”¨æ•°æ®
- **é¢‘ç‡**: æŒ‰æ—¥æœŸèŒƒå›´æ‰§è¡Œ
- **æ•°æ®**: è·å–åº”ç”¨çš„ä½¿ç”¨æ—¶é•¿ã€å¯åŠ¨æ¬¡æ•°ç­‰

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æ•°æ®åº“è¿æ¥å¤±è´¥
```
âŒ æ•°æ®åº“è¿æ¥å¤±è´¥: (2003, "Can't connect to MySQL server")
```
**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥æ•°æ®åº“æœåŠ¡æ˜¯å¦å¯åŠ¨
- éªŒè¯æ•°æ®åº“è¿æ¥é…ç½®
- ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸

#### 2. ä»»åŠ¡åˆ›å»ºå¤±è´¥
```
âŒ åˆ›å»ºä»»åŠ¡å¤±è´¥: ç”¨æˆ·ä¸å­˜åœ¨æˆ–åº”ç”¨æ— æ•ˆ
```
**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨ä¸”å·²å¯ç”¨
- éªŒè¯åº”ç”¨IDæ˜¯å¦æ­£ç¡®
- ç¡®è®¤ç”¨æˆ·åº”ç”¨å…³è”å…³ç³»

#### 3. ä»»åŠ¡æ‰§è¡Œè¶…æ—¶
```
â° å‘ç° X ä¸ªè¶…æ—¶ä»»åŠ¡
```
**è§£å†³æ–¹æ¡ˆ**:
- ä½¿ç”¨æ¢å¤è¶…æ—¶ä»»åŠ¡åŠŸèƒ½
- æ£€æŸ¥æ‰§è¡Œè®¾å¤‡çŠ¶æ€
- è°ƒæ•´ä»»åŠ¡è¶…æ—¶æ—¶é—´

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹ä»»åŠ¡æ‰§è¡Œæ—¥å¿—
tail -f logs/task_scheduler.log

# æŸ¥çœ‹è®¾å¤‡ç®¡ç†æ—¥å¿—
tail -f logs/device_manager.log

# æŸ¥çœ‹APIæ—¥å¿—
tail -f logs/api.log
```

### æ€§èƒ½ä¼˜åŒ–

#### 1. ä»»åŠ¡åˆ†æ‰¹å¤„ç†
```bash
# åˆ†æ‰¹åˆå§‹åŒ–å¤§é‡ä»»åŠ¡
python scripts/init_tasks.py --init-app-data --days 1
# ç­‰å¾…ä¸€æ®µæ—¶é—´åç»§ç»­
python scripts/init_tasks.py --init-app-data --days 1 --force
```

#### 2. è°ƒæ•´å¹¶å‘æ•°
```bash
# åœ¨standaloneæ¨¡å¼ä¸‹è°ƒæ•´å¹¶å‘ä»»åŠ¡æ•°
python main.py distribute standalone --device-id worker-01 --concurrent-tasks 5
```

#### 3. ä¼˜å…ˆçº§ç®¡ç†
```bash
# åˆ›å»ºé«˜ä¼˜å…ˆçº§ä»»åŠ¡
python scripts/init_tasks.py --create-task \
  --task-type user_apps \
  --username important@example.com \
  --priority 10
```

## ğŸ“ˆ æœ€ä½³å®è·µ

### 1. å®šæ—¶ä»»åŠ¡è®¾ç½®

å»ºè®®è®¾ç½®ä»¥ä¸‹å®šæ—¶ä»»åŠ¡ï¼š

```bash
# æ¯æ—¥å‡Œæ™¨2ç‚¹åˆå§‹åŒ–ç”¨æˆ·åº”ç”¨ä»»åŠ¡
0 2 * * * cd /path/to/af_crawl && python scripts/init_tasks.py --init-user-apps

# æ¯æ—¥å‡Œæ™¨3ç‚¹åˆå§‹åŒ–åº”ç”¨æ•°æ®ä»»åŠ¡
0 3 * * * cd /path/to/af_crawl && python scripts/init_tasks.py --init-app-data --days 1

# æ¯å°æ—¶é‡ç½®å¤±è´¥ä»»åŠ¡
0 * * * * cd /path/to/af_crawl && python scripts/init_tasks.py --reset-failed

# æ¯æ—¥æ¸…ç†è¿‡æœŸä»»åŠ¡
0 4 * * * cd /path/to/af_crawl && python scripts/init_tasks.py --clean-old --days 30
```

### 2. ç›‘æ§å‘Šè­¦

```bash
# æ£€æŸ¥å¤±è´¥ä»»åŠ¡æ•°é‡
failed_count=$(python scripts/init_tasks.py --stats | grep "failed" | awk '{print $2}')
if [ $failed_count -gt 100 ]; then
    echo "è­¦å‘Šï¼šå¤±è´¥ä»»åŠ¡æ•°é‡è¿‡å¤š ($failed_count)"
fi
```

### 3. æ•°æ®å¤‡ä»½

```bash
# å¤‡ä»½ä»»åŠ¡æ•°æ®
mysqldump -u username -p database_name cl_crawl_tasks > tasks_backup_$(date +%Y%m%d).sql
```

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [ä»»åŠ¡æµç¨‹æŒ‡å—](TASK_FLOW_GUIDE.md)
- [åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡](task_distribution_design.md)
- [ç‹¬ç«‹æ¨¡å¼æ‰§è¡Œæµç¨‹](STANDALONE_EXECUTION_FLOW.md)
- [APIæ–‡æ¡£](../api/README.md)